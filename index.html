<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>實時定位</title>
    <style>
        /* 设置地图容器的大小 */
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body>
    <h1>實時定位</h1>
    <!-- 地图容器 -->
    <div id="map"></div>

    <!-- 引入 Leaflet 库的 CSS 文件 -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <!-- 引入 Leaflet 库的 JavaScript 文件 -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        var map = L.map('map').setView([0, 0], 10);
        var marker; // 声明标记变量
        var bounds = L.latLngBounds([40.712, -74.227], [40.774, -74.125]);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        var isFirstLocation = true; // 用于标记是否是第一次获取位置

        function updateUserLocation() {
            navigator.geolocation.getCurrentPosition(function(position) {
                var lat = position.coords.latitude;
                var lng = position.coords.longitude;

                // 设置地图中心位置
                if (isFirstLocation) {
                    map.setView([lat, lng], 15); // 第一次定位时缩放
                    isFirstLocation = false; // 标记为非第一次定位
                } else {
                    map.panTo([lat, lng]); // 更新定位时不缩放
                }

                // 创建或更新用户位置标记
                if (!marker) {
                    // 创建定位的标记并设置红色图标
                    marker = L.marker([lat, lng], {icon: redIcon}).addTo(map);
                } else {
                    marker.setLatLng([lat, lng]);
                }
            }, function(error) {
                console.error('获取用户位置失败:', error);
            });
        }

        var redIcon = new L.Icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
            });

            map.on('click', function(event) {
            var lat = event.latlng.lat;
            var lng = event.latlng.lng;
            
            // 判断是否点击了指定位置附近
            var targetLat = 24.149611; // 目标纬度
            var targetLng = 120.683639; // 目标经度
            var threshold = 0.0001; // 允许的误差范围

            if (Math.abs(lat - targetLat) < threshold && Math.abs(lng - targetLng) < threshold) {
                // 如果点击位置接近指定位置，则显示选项
                var choice = prompt('你點擊了XX大樓！請問你要看什麽：\n1. 大樓介紹\n2. 科系介紹\n3. 小游戏');
                if (choice === '1') {
                    window.location.href = 'page1.html'; // 跳转到页面一
                } else if (choice === '2') {
                    window.location.href = 'page2.html'; // 跳转到页面二
                } else if (choice === '3') {
                    window.location.href = 'page3.html'; // 跳转到页面三
                } else {
                    alert('你按爽的嗎！！！');
                }
            }
        });


        // 初始化时更新用户位置
        updateUserLocation();
        
        // 每隔一段时间更新用户位置
        setInterval(updateUserLocation, 5000); // 每5秒更新一次位置

        // 标记几个坐标点
        var coordinates = [
            [24.149611, 120.683639],
            [24.150412633308154, 120.68306559887918],
            [24.149932396296602, 120.68247869372605],
            [24.1496005951253, 120.68297628722546],
            [24.150499948941835, 120.68385345525628],
            [24.15125377137894, 120.68286464766204],
            [24.151195561311393, 120.6839938021415],
            [24.151376012433865, 120.68231920860443],
            [24.152229312318074, 120.6834945118264]
        ];

        // 循环添加默认样式的标记
        coordinates.forEach(function(coord) {
            L.marker(coord).addTo(map);
        });
    </script>
</body>
</html>
